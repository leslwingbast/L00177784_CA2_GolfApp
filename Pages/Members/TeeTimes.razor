@page "/members/teetimes/{memberId:int}"
@using Data;
@inject TeeTimeService teeTimeService;
@inject GolfMemberService golfMemberService;
@inject NavigationManager navManager
@inject IJSRuntime js

<h3>Tee Times</h3>


@if (teeTimes.Count <= 0)
{
    <div class="row">
        <div class="form-group">
            <a class="btn btn-success" href="/teetimes/create"><i class="oi oi-plus"></i> Create New</a>
        </div>
    </div>

    <center>
        <p>Please wait while data is loading...</p>
        <div><img src="images/BallSpinner.gif"></div>
    </center>
}

else
{
    <div class="form-group">
        <a class="btn btn-success" href="/teetimes/create" title="Create a new Tee Time"><i class="oi oi-plus"></i> Create New</a>
    </div>
    <br />
    <table class="table">
        <thead>
            <tr class="fw-bold">
                <td>Date</td>
                <td>Tee Time</td>
                <td>Player Name</td>
                <td>Handicap</td>
                <td></td>
                <td></td>
            </tr>
        </thead>
        <tbody>
            @if (teeTimes.Count > 0)
            {
                @foreach (var eachtime in teeTimes)
                {
                    <tr class="align-middle">
                        <td>@eachtime.RoundDate.ToShortDateString()</td>
                        <td>@eachtime.RoundHour:@eachtime.RoundMinute.ToString("D2")</td>
                        <td>@eachtime.Player1.FirstName @eachtime.Player1.LastName <br />@eachtime.Player2.FirstName @eachtime.Player2.LastName <br />@eachtime.Player3.FirstName @eachtime.Player3.LastName <br />@eachtime.Player4.FirstName @eachtime.Player4.LastName </td>
                        <td>@eachtime.Player1.Handicap <br />@eachtime.Player2.Handicap <br />@eachtime.Player3.Handicap <br />@eachtime.Player4.Handicap </td>
                        <td>
                            @if (@eachtime.RoundDate > DateTime.Now.Date)
                            {
                                <a class="btn btn-success mx-3 py-1" href="teetimes/edit/@eachtime.Id">Edit</a>
                            }
                            else
                            {
                                <div class="btn btn-secondary mx-3 py-1" title="This Tee Times is in the past and can not be changed!">Edit</div>
                            }
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
}

@code {
    [Parameter]
    public int memberId { get; set; }
    private List<TeeTime> teeTimes;

    protected override async Task OnInitializedAsync()
    {
        await RefreshTeeTimes();
    }

    private async Task RefreshTeeTimes()
    {
        teeTimes = await teeTimeService.GetTeeTimesAsync();
        foreach (var teeTime in teeTimes)
        {
            teeTime.Player1 = golfMemberService.GetMember(teeTime.Player1Id);
            teeTime.Player2 = golfMemberService.GetMember(teeTime.Player2Id);
            teeTime.Player3 = golfMemberService.GetMember(teeTime.Player3Id);
            teeTime.Player4 = golfMemberService.GetMember(teeTime.Player4Id);
        }
        teeTimes = teeTimes.Where(x => x.Player1Id == memberId || x.Player2Id == memberId || x.Player3Id == memberId || x.Player4Id == memberId).ToList();
    }

}
